<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronos: 英国历史探索 - 龚凤乾教授设计</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;700&family=Inter:wght@400;600&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .serif { font-family: 'Crimson Pro', serif; }
        .bilingual-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        @media (max-width: 768px) { .bilingual-grid { grid-template-columns: 1fr; } }
        .play-btn { transition: all 0.2s; cursor: pointer; border-radius: 50%; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; background: rgba(59, 130, 246, 0.1); }
        .play-btn.playing { background: #22c55e; color: white; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .chat-scroll { max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const ERAS = [
            { id: 'pre-roman', name: '史前与凯尔特', enName: 'Pre-Roman & Celtic', year: 'Before AD 43', quickIntro: { zh: "史前时期的英国是不列颠文明的曙光，以巨石阵和凯尔特部落文明闻名。", en: "Pre-Roman Britain marks the dawn of civilization, famous for Stonehenge and Celtic tribes." }, detailedContent: { zh: "不列颠群岛的史前时期始于旧石器时代晚期...", en: "The prehistoric period of the British Isles began..." }, sources: [{ name: "British Museum", url: "https://www.britishmuseum.org" }] },
            { id: 'roman', name: '罗马统治时期', enName: 'Roman Britain', year: 'AD 43 - 410', quickIntro: { zh: "罗马人带来了城市、道路和法律。哈德良长城是重要遗迹。", en: "Romans introduced cities, roads, and laws." }, detailedContent: { zh: "公元43年，罗马皇帝克劳狄乌斯派遣四万大军...", en: "In AD 43, Emperor Claudius sent 40,000 troops..." }, sources: [{ name: "Roman Britain Org", url: "https://www.roman-britain.co.uk" }] },
            { id: 'anglo-saxon', name: '盎格鲁-撒克逊', enName: 'Anglo-Saxon Era', year: '410 - 1066', quickIntro: { zh: "罗马撤军后，日耳曼部落定居于此。", en: "After Romans left, Germanic tribes settled." }, detailedContent: { zh: "罗马军队撤离后，来自日德兰半岛的部落...", en: "After Roman withdrawal..." }, sources: [{ name: "British Library", url: "https://www.bl.uk/anglo-saxons" }] },
            { id: 'medieval', name: '中世纪盛期', enName: 'The Middle Ages', year: '1066 - 1485', quickIntro: { zh: "骑士、领主和大宪章的时代。", en: "An age of knights and Magna Carta." }, detailedContent: { zh: "诺曼征服后，威廉一世建立了封建制度...", en: "After the Norman Conquest..." }, sources: [{ name: "National Archives", url: "https://www.nationalarchives.gov.uk" }] },
            { id: 'tudor', name: '都铎王朝', enName: 'The Tudors', year: '1485 - 1603', quickIntro: { zh: "黄金时代，见证了宗教改革和海外扩张。", en: "The golden age of Henry VIII and Elizabeth I." }, detailedContent: { zh: "都铎王朝始于亨利·都铎获胜...", en: "The Tudor dynasty began..." }, sources: [{ name: "Royal Palaces", url: "https://www.hrp.org.uk" }] },
            { id: 'stuart', name: '斯图亚特王朝', enName: 'Stuart Period', year: '1603 - 1714', quickIntro: { zh: "经历了内战与光荣革命。", en: "Through Civil War and the Glorious Revolution." }, detailedContent: { zh: "斯图亚特王朝始于詹姆斯六世...", en: "The Stuart period began..." }, sources: [{ name: "Civil War Project", url: "https://www.english-heritage.org.uk" }] },
            { id: 'georgian', name: '乔治时代', enName: 'Georgian Era', year: '1714 - 1837', quickIntro: { zh: "大英帝国扩张与工业革命萌芽。", en: "Era of imperial expansion and Industrial Revolution." }, detailedContent: { zh: "以四位乔治国王命名...", en: "Named for four King Georges..." }, sources: [{ name: "Georgian Papers", url: "https://georgianpapers.com" }] },
            { id: 'victorian', name: '维多利亚时代', enName: 'Victorian Era', year: '1837 - 1901', quickIntro: { zh: "日不落帝国与社会变革。", en: "The peak of the British Empire." }, detailedContent: { zh: "维多利亚时代是大英帝国的鼎盛时期...", en: "The Victorian era marked the height..." }, sources: [{ name: "V&A Museum", url: "https://www.vam.ac.uk" }] },
            { id: 'edwardian', name: '爱德华时代', enName: 'Edwardian Era', year: '1901 - 1910', quickIntro: { zh: "一战前的短暂繁荣与宁静。", en: "Elegance and social unrest before WWI." }, detailedContent: { zh: "爱德华七世的统治是最后和平时期...", en: "Edward VII's reign was the last peaceful period..." }, sources: [{ name: "Edwardian Culture", url: "http://www.edwardianculture.com" }] },
            { id: 'world-wars', name: '世界大战时期', enName: 'World Wars Era', year: '1914 - 1945', quickIntro: { zh: "深刻改变了英国地位的岁月。", en: "Two World Wars reshaped Britain." }, detailedContent: { zh: "第一次世界大战永久改变了社会结构...", en: "WWI permanently altered society..." }, sources: [{ name: "IWM", url: "https://www.iwm.org.uk" }] },
            { id: 'post-war', name: '战后重建', enName: 'Post-War Period', year: '1945 - 1979', quickIntro: { zh: "福利国家建立与去殖民化。", en: "Birth of the welfare state." }, detailedContent: { zh: "工党政府建立了NHS...", en: "Labour government established the NHS..." }, sources: [{ name: "Parliament UK", url: "https://www.parliament.uk" }] },
            { id: 'thatcher', name: '撒切尔时代', enName: 'Thatcher Era', year: '1979 - 1990', quickIntro: { zh: "撒切尔夫人的激进经济改革。", en: "Margaret Thatcher's radical reforms." }, detailedContent: { zh: "推行国有企业私有化...", en: "Implemented neoliberal reforms..." }, sources: [{ name: "Thatcher Foundation", url: "https://www.margaretthatcher.org" }] },
            { id: 'modern', name: '现代英国', enName: 'Modern Britain', year: '1990 - Present', quickIntro: { zh: "全球化与数字化背景下的探索。", en: "Navigating globalization." }, detailedContent: { zh: "经历了欧盟一体化与脱欧...", en: "Witnessed EU integration and Brexit..." }, sources: [{ name: "GOV.UK", url: "https://www.gov.uk" }] }
        ];

        const App = () => {
            const [currentEra, setCurrentEra] = useState(ERAS[0]);
            const [content, setContent] = useState(ERAS[0].quickIntro);
            const [messages, setMessages] = useState([]);
            const [userInput, setUserInput] = useState("");
            const [speaking, setSpeaking] = useState({ zh: false, en: false });
            const chatEndRef = useRef(null);

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [messages]);

            const speak = (text, lang) => {
                const synth = window.speechSynthesis;
                synth.cancel();
                if (speaking[lang]) { setSpeaking({ zh: false, en: false }); return; }
                const ut = new SpeechSynthesisUtterance(text);
                ut.lang = lang === 'zh' ? 'zh-CN' : 'en-US';
                ut.onstart = () => setSpeaking({ ...speaking, [lang]: true });
                ut.onend = () => setSpeaking({ zh: false, en: false });
                synth.speak(ut);
            };

            const handleChat = async (e) => {
                e.preventDefault();
                if (!userInput.trim()) return;
                const newMsg = { role: 'user', content: userInput };
                setMessages(prev => [...prev, newMsg]);
                setUserInput("");

                try {
                    const res = await fetch('/.netlify/functions/deepseek-proxy', {
                        method: 'POST',
                        body: JSON.stringify({ era: `${currentEra.name}: ${userInput}` })
                    });
                    const data = await res.json();
                    setMessages(prev => [...prev, { role: 'ai', content: data.choices[0].message.content }]);
                } catch (err) {
                    setMessages(prev => [...prev, { role: 'ai', content: "抱歉，专家连线失败。请确认 API 配置。" }]);
                }
            };

            return (
                <div className="flex min-h-screen">
                    <aside className="w-72 bg-slate-900 text-white fixed h-full p-6 overflow-y-auto">
                        <h2 className="text-2xl font-bold text-blue-400 serif italic mb-8">Chronos</h2>
                        <nav className="space-y-1">
                            {ERAS.map(era => (
                                <button key={era.id} onClick={() => {setCurrentEra(era); setContent(era.quickIntro);}} className={`w-full text-left p-3 rounded-lg ${currentEra.id === era.id ? 'bg-blue-600' : 'hover:bg-slate-800 text-slate-400'}`}>
                                    <div className="text-sm font-bold">{era.enName}</div>
                                    <div className="text-[11px] opacity-60">{era.name}</div>
                                </button>
                            ))}
                        </nav>
                    </aside>
                    <main className="ml-72 flex-1 p-10 bg-white min-h-screen flex flex-col">
                        <header className="mb-10 border-b pb-8">
                            <h1 className="text-5xl font-black serif text-slate-900 mb-2">{currentEra.enName}</h1>
                            <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-bold">{currentEra.year}</span>
                        </header>
                        <div className="bilingual-grid mb-12">
                            <div className="p-8 bg-slate-50 rounded-2xl relative border border-slate-100">
                                <button onClick={() => speak(content.zh, 'zh')} className="play-btn absolute top-4 right-4"><i className="fas fa-volume-up"></i></button>
                                <p className="text-lg text-slate-800">{content.zh}</p>
                            </div>
                            <div className="p-8 bg-blue-50/50 rounded-2xl relative border border-blue-100">
                                <button onClick={() => speak(content.en, 'en')} className="play-btn absolute top-4 right-4"><i className="fas fa-volume-up"></i></button>
                                <p className="text-xl serif italic text-slate-700">{content.en}</p>
                            </div>
                        </div>
                        <section className="mt-auto bg-slate-100 p-6 rounded-2xl border border-slate-200">
                            <h3 className="font-bold mb-4 flex items-center gap-2"><i className="fas fa-robot text-blue-600"></i> 向历史专家提问</h3>
                            <div className="chat-scroll space-y-4 mb-4">
                                {messages.map((m, i) => (
                                    <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`p-3 rounded-xl max-w-[80%] ${m.role === 'user' ? 'bg-blue-600 text-white' : 'bg-white border'}`}>{m.content}</div>
                                    </div>
                                ))}
                                <div ref={chatEndRef} />
                            </div>
                            <form onSubmit={handleChat} className="flex gap-2">
                                <input type="text" value={userInput} onChange={e => setUserInput(e.target.value)} className="flex-1 p-3 rounded-lg border" placeholder="输入问题..." />
                                <button type="submit" className="bg-slate-900 text-white px-6 py-3 rounded-lg">发送</button>
                            </form>
                        </section>
                    </main>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>